Date: 2015-10-28
Title: 重构_改善既有代码的设计
Tags: Reading, Refactoring



## 第一章 重构、第一个案例

### Tips
- 如果你发现自己需要为程序添加一个特性，而代码结构使你无法很方便地达成目的，那就先重构那个程序，是特性的添加比较容易进行，然后再添加特性
- 先看看有没有一套OK的测试机制，这些测试要有自我检测能力
- 尽量干掉一些临时变量，但是需要考虑性能问题
- 函数应该放在它所使用的数据的所属对象内
- 考虑使用多态来替换那些if else, switch case - State 模式
- 测试、小修改、测试、小修改、测试、小修改

### 总结
该重构时就重构，自动化测试是前提，提炼函数，临时变量，switch case，变量名是重点
但是自动化测试一般没有，怎么破？



## 第二章 重构原则
### 正文
- 定义
	- 对软件内部结构的一种调整， 目的是在不改变软件可观查行为的前提下，提高其可理解性，降低其修改成本
	- 使用一系列重构手法， 在不改变软件可观察行为的前提下，调整其结构

- 为何重构
	- 改进软件设计， 软件结构会流失， 重构维持其现有形态
	- 让软件更易理解
	- 帮助找到bug
	- 提高编程速度

- 何时重构
	- 第一次就去做吧，第二次会不爽，忍忍， 第三次就重构吧
	- 添加功能时，如果发现不能轻松的添加你想要的功能，那就先重构他，然后再添加新功能
	- 代码复审时重构


- 怎么跟经理说
	- 质量驱动 - 提
	- 进度驱动 - 不提，直接重构


### 重构为什么有用
- 现状
	- 难以阅读，难以修改
	- 逻辑重复，难以修改
	- 添加新逻辑，修改现有代码，难以修改
	- 复杂逻辑条件，难以修改

- 目的
	- 容易阅读
	- 所有逻辑都只在唯一地点指定
	- 新的改动不会危及现有逻辑
	- 尽可能简单表达条件逻辑

### 间接层与重构
计算机是这样一门科学：它相信所有问题都可以通过增加一个间接层来解决，一顿还是两顿烧烤？

重构很多时候就是在增加间接层，大对象拆分成小对象，大函数拆成小函数
优点：
- 允许逻辑共享
- 分开解释意图和实现  
	- 其实就是给函数或者类取个好名字
- 隔离变化
- 封装条件逻辑

- 重构 VS 事前设计


